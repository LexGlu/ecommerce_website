{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'store/images/favicon.ico' %}">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <!-- Font Awesome CSS -->
    <link rel="stylesheet" type="text/css"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'store/css/custom.css' %}">

    <!-- JS -->
    <script type="text/javascript">

        let user = "{{ request.user}}"

        function getToken(name) {
		    let cookieValue = null;
		    if (document.cookie && document.cookie !== '') {
		        let cookies = document.cookie.split(';');
		        for (let i = 0; i < cookies.length; i++) {
		            let cookie = cookies[i].trim();
		            // Does this cookie string begin with the name we want?
		            if (cookie.substring(0, name.length + 1) === (name + '=')) {
		                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
		                break;
		            }
		        }
		    }
		    return cookieValue;
		}
		let csrftoken = getToken('csrftoken')

    </script>

    <title>{% block title %}{% endblock %}</title>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light" style="background: #F0F0F0">
      <div class="container-fluid" id="navbar">
        <a class="navbar-brand" href="{% url 'store:home' %}">
            <img src="{% static 'store/images/logo.png' %}"
                                 width="30" height="30"
                                 class="d-inline-block align-top"
                                 alt="logo">
            PineApple
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="{% url 'store:home' %}">Store</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Categories
              </a>
              <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                  {% for category in categories %}
                       <li><a class="dropdown-item" href="{% url 'store:category' category.slug  %}">{{ category.name }}</a></li>
                  {% endfor %}
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="{% url 'store:home' %}">All categories</a></li>
              </ul>
            </li>
          </ul>

            <div id="searchbar" class="form-inline my-2 my-lg-0">
            <form class="d-flex" action="{% url 'store:search' %}">
                <input class="form-control me-2" type="search" placeholder="I'm searching for..." aria-label="Search"
                name="query" required>
                <button class="btn btn-outline-primary product-view" type="submit">
                    <i class="fa fa-search"></i>
                </button>
            </form>
            </div>

            <div class="form-inline my-2 my-lg-0">

                {% if user.is_authenticated %}
                    <a href="{% url "store:customer_orders" %}" style="display: inline-block">
                    <img id="orders-icon" src="{% static 'store/images/list.png' %}" alt="customer orders">
                    </a>

                    <a href="{% url "store:logout" %}" class="btn btn-danger log-btn">Logout</a>
                {% else %}
                    <a href="{% url "store:login" %}" class="btn btn-primary log-btn">Login</a>
                {% endif %}


            <div class="cart-icon-container">
                <a href="{% url 'store:cart' %}" style="display: inline-block">
	    		    <img  class="cart-icon" src="{% static 'store/images/shopping-cart.png' %}" alt="cart">
                </a>

                {% if items_in_cart %}
                    <div class="cart-icon-total" id="cart-count-form">
                            <p class="" id="cart-count">{{ items_in_cart }}</p>
                    </div>
                    {% else %}
                    <div class="cart-icon-total hidden" id="cart-count-form">
                            <p class="" id="cart-count">{{ items_in_cart }}</p>
                    </div>
                {% endif %}
            </div>

            </div>
        </div>
      </div>
    </nav>

    <main>
      {% block content %}{% endblock %}
    </main>
    <footer style="margin-bottom: 20px">
        &copy 2023 PineApple Store. All rights not reserved.
    </footer>
<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>
<script type="text/javascript" src="{% static 'store/js/cart.js' %}"></script>
</body>
</html>