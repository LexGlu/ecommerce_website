{% extends 'store/base.html' %}
{% load custom_filter %}
{% load static %}

{% block title %}
    {{ category.name }}
{% endblock %}

{% block content %}
<h3>{{ category.name }}</h3>

    <div class="catalog-head" id="catalog-head">
        <form id="filter-form" action="" method="GET">
            <div class="catalog-filter">
                <div class="brand-filter">
                    <h4>Brands:</h4>
                    {% for brand in category.brands %}
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="brand" value="{{ brand }}" id="brand-{{ brand }}">
                        <label class="form-check-label" for="brand-{{ brand }}">{{ brand }}</label>
                    </div>
                    {% endfor %}
                </div>
                <div class="price-filter">
                    <h4>Price Range:</h4>
                    <div class="input-group">
                        <span class="input-group-text">UAH</span>
                        <input type="text" class="form-control" name="min_price" placeholder="Min Price">
                    </div>
                    <div class="input-group">
                        <span class="input-group-text">UAH</span>
                        <input type="text" class="form-control" name="max_price" placeholder="Max Price">
                    </div>
                    <button type="submit" class="btn btn-primary">OK</button>
                </div>
            </div>

            <select id="sort-select" class="form-select" aria-label="Default select example">
                <option value="expensive">Price: High to Low</option>
                <option value="cheap">Price: Low to High</option>
                <option value="rating">Highest rating</option>
            </select>
        </form>

    </div>

        <div class="row">

        {% if not page_obj %}
        <div class="col-lg-12">
            <h3>No products found with existing query</h3>
        </div>

        {% else %}
            {% for product in page_obj %}
            <div class="col-lg-4">
                <div class="box-element product-image-container">
                <a href="{% url 'store:product' product.id %}">
                    <img src="{{ product.image.url }}" alt="{{ product.name }}"
                     class="thumbnail">
                </a>
                </div>
                <div class="box-element product">
                    <a class= "product-link" href="{% url 'store:product' product.id %}">
                        <h6 class="product-title"><strong>{{product.name}}</strong></h6>
                    </a>
                    <hr>
                    <div style="height: 25px">
                    <button data-product="{{product.id}}"
                            data-action="add"
                            class="btn btn-light update-cart add-to-cart"
                            style=" float: right">
                            <img
                                src="{% static 'store/images/shopping-cart-add.png' %}"
                                alt="add-to-cart" style="width: 20px; height: 20px">
                    </button>
                    {% if product.total_reviews > 0 %}
                        &nbsp&nbsp{{ product.rating_stars | safe }}
                    {% endif %}
                    <h4 style="display: inline-block; float: left; margin-top: -3px"><strong>{{product.price | currency}}</strong></h4>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <nav aria-label="Page navigation example" style="margin-top: 16px">
          <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
              <li class="page-item">
                <a class="page-link" href="?page=1{% if params %}&{{ params }}{% endif %}" aria-label="First">
                  <span aria-hidden="true">&laquo;&laquo;</span>
                  <span class="sr-only">First</span>
                </a>
              </li>
              <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if params %}&{{ params }}{% endif %}" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                  <span class="sr-only">Previous</span>
                </a>
              </li>
            {% else %}
              <li class="page-item disabled">
                <a class="page-link" href="#" tabindex="-1" aria-disabled="true">
                  <span aria-hidden="true">&laquo;&laquo;</span>
                  <span class="sr-only">First</span>
                </a>
              </li>
              <li class="page-item disabled">
                <a class="page-link" href="#" tabindex="-1" aria-disabled="true">
                  <span aria-hidden="true">&laquo;</span>
                  <span class="sr-only">Previous</span>
                </a>
              </li>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
              {% if num == page_obj.number %}
                <li class="page-item active" aria-current="page">
                  <a class="page-link" href="#">{{ num }}</a>
                </li>
              {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <li class="page-item">
                  <a class="page-link" href="?page={{ num }}{% if params %}&{{ params }}{% endif %}">{{ num }}</a>
                </li>
              {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
              <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if params %}&{{ params }}{% endif %}" aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                  <span class="sr-only">Next</span>
                </a>
              </li>
              <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if params %}&{{ params }}{% endif %}" aria-label="Last">
                  <span aria-hidden="true">&raquo;&raquo;</span>
                  <span class="sr-only">Last</span>
                </a>
              </li>
            {% else %}
              <li class="page-item disabled">
                <a class="page-link" href="#" tabindex="-1" aria-disabled="true">
                  <span aria-hidden="true">&raquo;</span>
                  <span class="sr-only">Next</span>
                </a>
              </li>
              <li class="page-item disabled">
                <a class="page-link" href="#" tabindex="-1" aria-disabled="true">
                  <span aria-hidden="true">&raquo;&raquo;</span>
                  <span class="sr-only">Last</span>
                </a>
              </li>
            {% endif %}
          </ul>
        </nav>
        {% endif %}

    <script src="{% static 'store/js/category_filter.js' %}"></script>

{% endblock %}