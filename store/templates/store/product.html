{% extends 'store/base.html' %}
{% load custom_filter %}
{% load static %}



{% block title %}
    {{ product.name }}
{% endblock %}

{% block content %}


  <div class="product-detail">
    <div class="product-image" >
      <img src="{{ product.get_image_url }}" alt="{{ product.name }}" id="{{ product.image.url }}">
    </div>
    <div class="product-info">
      <h1 class="product-name">{{ product.name }}</h1>
      <p class="product-price">{{ product.price | currency }}</p>
      <p class="product-description">{{ product.description }}</p>
      <p class="product-category">Category:
          <a class="product-link" href="{% url 'store:category' product.category.slug %}">
                    {{ product.category.name }}
          </a>
      </p>

      {% if product.is_in_stock %}
        <p class="product-status in-stock">In stock</p>
          <div class="product-action">
                    <button data-product="{{product.id}}"
                            data-action="add"
                            class="btn btn-light update-cart add-to-cart"
                            style="float: left; height: 50px; width: 50px">
                            <img
                                src="{% static 'store/images/shopping-cart-add.png' %}"
                                alt="add-to-cart" style="width: 20px; height: 20px">
                    </button>
                    <div>
                        <strong style="margin-left: 10px">Add to cart</strong>
                    </div>
            </div>
      {% else %}
        <p class="product-status out-of-stock">Out of stock</p>
      {% endif %}
    </div>
  </div>
  <div class="product-reviews">
    <h2>Customer Reviews</h2>
    {% for review in product.review_set.all %}
      <div class="review">
        <div class="review-rating">
          {{ review.rating_stars | safe }}
          <span class="rating-display">{{ review.get_rating_display }}</span>
        </div>
        <div class="review-comment">
          <p>{{ review.comment }}</p>
          <p class="review-author">Reviewed by {{ review.user.full_name }}</p>
          <p class="review-date">{{ review.created_at|date:"F j, Y" }}</p>
        </div>
      </div>
    {% empty %}
      <p>No reviews yet.</p>
    {% endfor %}
    {% if user.is_authenticated %}

    <a href="{% url 'store:add_review' product.id %}">Add a review</a>
    {% else %}
    <p><a href="{% url 'store:login' %}">Login</a> to add a review.</p>
    {% endif %}
  </div>


<!-- The Modal -->
<div id="myModal" class="modal">
  <span class="close">&times;</span>
  <img class="modal-content" id="img01">
  <div id="caption"></div>
</div>


<script>
// Get the modal
let modal = document.getElementById('myModal');

// Get the image and insert it inside the modal - use its "alt" text as a caption
let img = document.getElementById('{{ product.image.url }}');
let modalImg = document.getElementById('img01');
let captionText = document.getElementById("caption");
img.onclick = function(){
  modal.style.display = "block";
  modalImg.src = this.src;
}

// Get the <span> element that closes the modal
let span = document.getElementsByClassName("close")[0];

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}
</script>


{% endblock %}